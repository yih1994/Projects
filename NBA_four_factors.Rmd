---
title: "NBA_four_factors"
author: "Yi Hu"
date: "3/3/2018"
output: html_document
---

test on the probability of wins on age
```{r}
table(Age)

plot(Age, PW)
abline(lm(PW~Age))
m1 <- lm(PW~Age)
summary(m1)

```

Age ranges from 23.2 to 30.7；Based on the positive relationships between the age and the 

```{r}
library(car)
qqPlot(m1)

spreadLevelPlot(m1)
crPlots(m1, span=0.7)

ncvTest(m1)
# do confidence interval of m1
confint(m1)
```

 a test on the margin of victory (MOV) = points - opponent points
```{r}
m2 <- lm(PW~MOV)
summary(m2)
```
cannot interpret anything with MOV. interrelated to each other!

```{r}
m3<- lm(PW~SOS)
summary(m3)
```
SOS: strength of schedule; it may relate to players' physical strength significantly(assumption)
SOS and PW has a negative correlation, with large variation

SRS = MOV+SOS; therefore, it is closely related to PW because it contains the part of MOV. 
```{r}
m4 <- lm(PW~ORtg)
summary(m4)

m5 <- lm(PW~DRtg)
summary(m5)

m6 <- lm(PW~ORtg+DRtg)
summary(m6)
```


```{r}
m7 <- lm(PW~Pace)
summary(m7)
```
It does not show significant evidence that Pace is influencial.


```{r}
plot (FTr, PW)
m8 <- lm(PW~FTr)
summary(m8)
```

3PAr: 三分命中 rate
TS%:True Shooting Percentage
Effective Field Goal Percentage   eFG
O_TOV% 进攻失误 rate
rb 篮板

###mmp plots to show all the lowess lines

###cross validation

##check the overfitting
Still run the AIC and BIC, just for calculations; showing that we have done the work

- maybe I can work on the addictive model and nonaddictive model to whether there are combined effect

- figure out how to do the categorical ... ones....
//One categorical factor is whether the team is playing at its home field


- also, for additional information, we have examined the Age, SOS and Pace related to the model
//think about these factors as out-of-game factors; since they may relate to the four factors(correlation)
//With both respective to O and to D

```{r AIC/BIC test}
offensive_ABIC <- cbind(AIC(offensive_four_factors), BIC(offensive_four_factors))
defensive_ABIC <- cbind(AIC(defensive_four_factors), BIC(defensive_four_factors))
offensive_ABIC
defensive_ABIC
```

BIC has a harsher penalty; therefore, BIC generally has a larger number than AIC

```{r regression on Age+Pace+SOS}
#using the datasets of training
offensive_others <- lm(ORtg~Age+Pace+SOS, data = training)
summary(offensive_others)
defensive_others <- lm(DRtg~Age+Pace+SOS, data = training)
summary(defensive_others)

#using the dataset of team_stats
offensive_others2 <- lm(ORtg~Age+Pace+SOS, data = team_stats)
summary(offensive_others2)
defensive_others2 <- lm(DRtg~Age+Pace+SOS, data = team_stats)
summary(defensive_others2)


```

```{r}

offensive_others2_add <- lm(ORtg~Age+Pace+SOS+Age*Pace +Age*SOS +SOS*Pace, data = team_stats)
summary(offensive_others2_add)
defensive_others2_add <- lm(DRtg~Age+Pace+SOS+Age*SOS, data = team_stats)
summary(defensive_others2_add)
#little change on R^2, no relevancy

```




```{r addictive model on sos age and pace}
#on sos
offensive_sos_4factors_nonadd <- lm(ORtg ~`O_eFG%` + `O_TOV%`  + `ORB%` + `O_FT/FGA` + SOS_Cat*`O_eFG%` +SOS_Cat*`O_TOV%` + SOS_Cat*`ORB%` + SOS_Cat*`O_FT/FGA`, data = team_stats)
summary(offensive_sos_4factors_nonadd)
defensive_sos_4factors_nonadd <- lm(DRtg ~`D_eFG%` + `D_TOV%`  + `DRB%` + `D_FT/FGA` + SOS_Cat*`D_eFG%` +SOS_Cat*`D_TOV%` + SOS_Cat*`DRB%` + SOS_Cat*`D_FT/FGA`, data = team_stats)
summary(defensive_sos_4factors_nonadd)

#on age
offensive_age_4factors_nonadd <- lm(ORtg ~`O_eFG%` + `O_TOV%`  + `ORB%` + `O_FT/FGA` + Age_Cat*`O_eFG%` + Age_Cat*`O_TOV%` + Age_Cat*`ORB%` + Age_Cat*`O_FT/FGA`, data = team_stats)
summary(offensive_age_4factors_nonadd)
defensive_age_4factors_nonadd <- lm(DRtg ~`D_eFG%` + `D_TOV%`  + `DRB%` + `D_FT/FGA` + Age_Cat*`D_eFG%` + Age_Cat*`D_TOV%` + Age_Cat*`DRB%` + Age_Cat*`D_FT/FGA`, data = team_stats)
summary(defensive_age_4factors_nonadd)

#on pace
offensive_pace_4factors_nonadd <- lm(ORtg ~`O_eFG%` + `O_TOV%`  + `ORB%` + `O_FT/FGA` + Pace_Cat*`O_eFG%` + Pace_Cat*`O_TOV%` + Pace_Cat*`ORB%` + Pace_Cat*`O_FT/FGA`, data = team_stats)
summary(offensive_pace_4factors_nonadd)
defensive_pace_4factors_nonadd <- lm(DRtg ~`D_eFG%` + `D_TOV%`  + `DRB%` + `D_FT/FGA` + Pace_Cat*`D_eFG%` + Pace_Cat*`D_TOV%` + Pace_Cat*`DRB%` + Pace_Cat*`D_FT/FGA`, data = team_stats)
summary(defensive_pace_4factors_nonadd)

#the best model
offensive_age_sos_OFT <- lm(ORtg ~`O_eFG%` + `O_TOV%`  + `ORB%` + `O_FT/FGA` + Age_Cat*`O_FT/FGA` + SOS_Cat*`O_FT/FGA`, data = team_stats)
summary(offensive_age_sos_OFT)

defensive_age_pace_efG_TOV <- lm(DRtg ~`D_eFG%` + `D_TOV%`  + `DRB%` + `D_FT/FGA` + Pace_Cat*`D_TOV%` + Age_Cat*`D_eFG%`, data = team_stats)
summary(defensive_age_pace_efG_TOV)

```

```{r AIC/BIC test on cat_add_model}
AIC(offensive_age_4factors_nonadd, offensive_pace_4factors_nonadd, offensive_sos_4factors_nonadd)
BIC(offensive_age_4factors_nonadd, offensive_pace_4factors_nonadd, offensive_sos_4factors_nonadd)
AIC(defensive_age_4factors_nonadd, defensive_pace_4factors_nonadd, defensive_sos_4factors_nonadd)
BIC(defensive_age_4factors_nonadd, defensive_pace_4factors_nonadd, defensive_sos_4factors_nonadd)
```

# get the offensive_sos_4factors_nonadd
# get the defensive_pace_4factors_nonadd


```{r}
summary(FactorsPlayoffModel)
```

```{r stepwise model}

#backward and forward selection
backAIC <- step(FactorsPlayoffModel,direction="backward")
forwardAIC <- step(FactorsPlayoffModel,direction="forward")

FactorsPlayoffModel2 <- update(FactorsPlayoffModel, .~.-ORB_Percent)
summary(FactorsPlayoffModel2)
FactorsPlayoffModel3 <- update(FactorsPlayoffModel2, .~.-`DRB%`)
summary(FactorsPlayoffModel3)
FactorsPlayoffModel4 <- update(FactorsPlayoffModel3, .~.-`D_FT/FGA`)
summary(FactorsPlayoffModel4)
#Based on the null deviance, the parameters in the models explain the data equally well.
```

```{r w/o O_RB%}

NewFactorsPlayoffModelIntercept <- numeric(5)
NewFactorsPlayoffModelInterceptSignificance <- numeric(5)
NewFactorsPlayoffModelInterceptConfLow <- numeric(5)
NewFactorsPlayoffModelInterceptConfHigh <- numeric(5)

NewFactorsPlayoffModelOShootingSlope <- numeric(5)
NewFactorsPlayoffModelOShootingSlopeSignificance <- numeric(5)
NewFactorsPlayoffModelOShootingSlopeConfLow <- numeric(5)
NewFactorsPlayoffModelOShootingSlopeConfHigh <- numeric(5)

NewFactorsPlayoffModelOTurnoverSlope <- numeric(5)
NewFactorsPlayoffModelOTurnoverSlopeSignificance <- numeric(5)
NewFactorsPlayoffModelOTurnoverSlopeConfLow <- numeric(5)
NewFactorsPlayoffModelOTurnoverSlopeConfHigh <- numeric(5)

NewFactorsPlayoffModelOFreeThrowSlope <- numeric(5)
NewFactorsPlayoffModelOFreeThrowSlopeSignificance <- numeric(5)
NewFactorsPlayoffModelOFreeThrowSlopeConfLow <- numeric(5)
NewFactorsPlayoffModelOFreeThrowSlopeConfHigh <- numeric(5)

NewFactorsPlayoffModelDShootingSlope <- numeric(5)
NewFactorsPlayoffModelDShootingSlopeSignificance <- numeric(5)
NewFactorsPlayoffModelDShootingSlopeConfLow <- numeric(5)
NewFactorsPlayoffModelDShootingSlopeConfHigh <- numeric(5)

NewFactorsPlayoffModelDReboundingSlope <- numeric(5)
NewFactorsPlayoffModelDReboundingSlopeSignificance <- numeric(5)
NewFactorsPlayoffModelDReboundingSlopeConfLow <- numeric(5)
NewFactorsPlayoffModelDReboundingSlopeConfHigh <- numeric(5)

NewFactorsPlayoffModelDTurnoverSlope <- numeric(5)
NewFactorsPlayoffModelDTurnoverSlopeSignificance <- numeric(5)
NewFactorsPlayoffModelDTurnoverSlopeConfLow <- numeric(5)
NewFactorsPlayoffModelDTurnoverSlopeConfHigh <- numeric(5)

NewFactorsPlayoffModelDFreeThrowSlope <- numeric(5)
NewFactorsPlayoffModelDFreeThrowSlopeSignificance <- numeric(5)
NewFactorsPlayoffModelDFreeThrowSlopeConfLow <- numeric(5)
NewFactorsPlayoffModelDFreeThrowSlopeConfHigh <- numeric(5)

NewFactorsPlayoffModelPearson <- numeric(5)

NewFactorsPlayoffModelConfusionZeroZero <- numeric(5)
NewFactorsPlayoffModelConfusionOneZero <- numeric(5)
NewFactorsPlayoffModelConfusionZeroOne <- numeric(5)
NewFactorsPlayoffModelConfusionOneOne <- numeric(5)

for(i in 1:5){ #an iteration for each CV fold
  #Allocating test/training sets for each CV fold
  test <- team_stats[cases[[i]], ]
  training <- team_stats[-cases[[i]], ]
  
  NewFactorsPlayoffModel <- glm(formula = Playoff ~ O_eFG_Percent + O_TOV_Percent + O_FT_Per_100_FGA + `D_eFG%` + `DRB%` + `D_TOV%` + `D_FT/FGA`, family = binomial(link="logit"), data = training)
  
  NewFactorsPlayoffModelIntercept[i] <- NewFactorsPlayoffModel$coefficients[1]
  NewFactorsPlayoffModelInterceptSignificance[i] <- summary(NewFactorsPlayoffModel)$coefficients[1, 4]
  NewFactorsPlayoffModelOShootingSlope[i] <- NewFactorsPlayoffModel$coefficients[2]
  NewFactorsPlayoffModelOShootingSlopeSignificance[i] <- summary(NewFactorsPlayoffModel)$coefficients[2, 4]
  NewFactorsPlayoffModelOTurnoverSlope[i] <- NewFactorsPlayoffModel$coefficients[3]
  NewFactorsPlayoffModelOTurnoverSlopeSignificance[i] <- summary(NewFactorsPlayoffModel)$coefficients[3, 4]
  NewFactorsPlayoffModelOFreeThrowSlope[i] <- NewFactorsPlayoffModel$coefficients[4]
  NewFactorsPlayoffModelOFreeThrowSlopeSignificance[i] <- summary(NewFactorsPlayoffModel)$coefficients[4, 4]
  NewFactorsPlayoffModelDShootingSlope[i] <- NewFactorsPlayoffModel$coefficients[5]
  NewFactorsPlayoffModelDShootingSlopeSignificance[i] <- summary(NewFactorsPlayoffModel)$coefficients[5, 4]
  NewFactorsPlayoffModelDReboundingSlope[i] <- NewFactorsPlayoffModel$coefficients[6]
  NewFactorsPlayoffModelDReboundingSlopeSignificance[i] <- summary(NewFactorsPlayoffModel)$coefficients[6, 4]
  NewFactorsPlayoffModelDTurnoverSlope[i] <- NewFactorsPlayoffModel$coefficients[7]
  NewFactorsPlayoffModelDTurnoverSlopeSignificance[i] <- summary(NewFactorsPlayoffModel)$coefficients[7, 4]
  NewFactorsPlayoffModelDFreeThrowSlope[i] <- NewFactorsPlayoffModel$coefficients[8]
  NewFactorsPlayoffModelDFreeThrowSlopeSignificance[i] <- summary(NewFactorsPlayoffModel)$coefficients[8, 4]
  
  NewFactorsPlayoffModelInterceptConfLow[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[9]
  NewFactorsPlayoffModelInterceptConfHigh[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[17]
  NewFactorsPlayoffModelOShootingSlopeConfLow[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[10]
  NewFactorsPlayoffModelOShootingSlopeConfHigh[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[18]
  NewFactorsPlayoffModelOTurnoverSlopeConfLow[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[11]
  NewFactorsPlayoffModelOTurnoverSlopeConfHigh[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[19]
  NewFactorsPlayoffModelOFreeThrowSlopeConfLow[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[12]
  NewFactorsPlayoffModelOFreeThrowSlopeConfHigh[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[20]
  NewFactorsPlayoffModelDShootingSlopeConfLow[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[13]
  NewFactorsPlayoffModelDShootingSlopeConfHigh[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[21]
  NewFactorsPlayoffModelDReboundingSlopeConfLow[i] <-  round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[14]
  NewFactorsPlayoffModelDReboundingSlopeConfHigh[i] <-  round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[22]
  NewFactorsPlayoffModelDTurnoverSlopeConfLow[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[15]
  NewFactorsPlayoffModelDTurnoverSlopeConfHigh[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[23]
  NewFactorsPlayoffModelDFreeThrowSlopeConfLow[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[16]
  NewFactorsPlayoffModelDFreeThrowSlopeConfHigh[i] <- round(exp(cbind(Estimate = coef(NewFactorsPlayoffModel), confint(NewFactorsPlayoffModel))), 2)[24]
  
  NewFactorsPlayoffModelPearson[i] <- round(sum(residuals(NewFactorsPlayoffModel, type = "pearson")^2), 3)

  test$Prediction <- predict(NewFactorsPlayoffModel, test, type = "response")
  test$Prediction <- ifelse(test$Prediction > .5, 1, 0)
  
  NewConfusion <- table(test$Prediction, test$Playoff)
  
  NewFactorsPlayoffModelConfusionZeroZero[i] <- NewConfusion[1]
  NewFactorsPlayoffModelConfusionOneZero[i] <- NewConfusion[2]
  NewFactorsPlayoffModelConfusionZeroOne[i] <- NewConfusion[3]
  NewFactorsPlayoffModelConfusionOneOne[i] <- NewConfusion[4]
  
}

print(paste("Confusion Zero/Zero", sum(NewFactorsPlayoffModelConfusionZeroZero)))
print(paste("Confusion One/Zero", sum(NewFactorsPlayoffModelConfusionOneZero)))
print(paste("Confusion Zero/One", sum(NewFactorsPlayoffModelConfusionZeroOne)))
print(paste("Confusion One/One", sum(NewFactorsPlayoffModelConfusionOneOne)))

print(paste("Intercept Value" ,mean(NewFactorsPlayoffModelIntercept)))
print(paste("Exp(Intercept Value)", exp(mean(NewFactorsPlayoffModelIntercept))))
print(paste("Intercept Significance", mean(NewFactorsPlayoffModelInterceptSignificance)))
print(paste("Intercept Exp(Value) Low", mean(NewFactorsPlayoffModelInterceptConfLow)))
print(paste("Intercept Exp(Value) High", mean(NewFactorsPlayoffModelInterceptConfHigh)))

print(paste("Offense Shooting Slope Value", mean(NewFactorsPlayoffModelOShootingSlope)))
print(paste("Offense Shooting Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelOShootingSlope))))
print(paste("Offense Shooting Slope Significance", mean(NewFactorsPlayoffModelOShootingSlopeSignificance)))
print(paste("Offense Shooting Exp(Slope Value) Low", mean(NewFactorsPlayoffModelOShootingSlopeConfLow)))
print(paste("Offense Shooting Exp(Slope Value) High", mean(NewFactorsPlayoffModelOShootingSlopeConfHigh)))

print(paste("Offense Turnovers Slope Value", mean(NewFactorsPlayoffModelOTurnoverSlope)))
print(paste("Offense Turnovers Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelOTurnoverSlope))))
print(paste("Offense Turnovers Slope Significance", mean(NewFactorsPlayoffModelOTurnoverSlopeSignificance)))
print(paste("Offense Turnovers Exp(Slope Value) Low", mean(NewFactorsPlayoffModelOTurnoverSlopeConfLow)))
print(paste("Offense Turnovers Exp(Slope Value) High", mean(NewFactorsPlayoffModelOTurnoverSlopeConfHigh)))

print(paste("Offense Free Throw Slope Value", mean(NewFactorsPlayoffModelOFreeThrowSlope)))
print(paste("Offense Free Throw Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelOFreeThrowSlope))))
print(paste("Offense Free Throw Slope Significance", mean(NewFactorsPlayoffModelOFreeThrowSlopeSignificance)))
print(paste("Offense Free Throw Exp(Slope Value) Low", mean(NewFactorsPlayoffModelOFreeThrowSlopeConfLow)))
print(paste("Offense Free Throw Exp(Slope Value) High", mean(NewFactorsPlayoffModelOFreeThrowSlopeConfHigh)))

print(paste("Defense Shooting Slope Value", mean(NewFactorsPlayoffModelDShootingSlope)))
print(paste("Defense Shooting Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelDShootingSlope))))
print(paste("Defense Shooting Slope Significance", mean(NewFactorsPlayoffModelDShootingSlopeSignificance)))
print(paste("Defense Shooting Exp(Slope Value) Low", mean(NewFactorsPlayoffModelDShootingSlopeConfLow)))
print(paste("Defense Shooting Exp(Slope Value) High", mean(NewFactorsPlayoffModelDShootingSlopeConfHigh)))

print(paste("Defense Rebounding Slope Value", mean(NewFactorsPlayoffModelDReboundingSlope)))
print(paste("Defense Rebounding Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelDReboundingSlope))))
print(paste("Defense Rebounding Slope Significance", mean(NewFactorsPlayoffModelDReboundingSlopeSignificance)))
print(paste("Defense Rebounding Exp(Slope Value) Low", mean(NewFactorsPlayoffModelDReboundingSlopeConfLow)))
print(paste("Defense Rebounding Exp(Slope Value) High", mean(NewFactorsPlayoffModelDReboundingSlopeConfHigh)))

print(paste("Defense Turnovers Slope Value", mean(NewFactorsPlayoffModelDTurnoverSlope)))
print(paste("Defense Turnovers Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelDTurnoverSlope))))
print(paste("Defense Turnovers Slope Significance", mean(NewFactorsPlayoffModelDTurnoverSlopeSignificance)))
print(paste("Defense Turnovers Exp(Slope Value) Low", mean(NewFactorsPlayoffModelDTurnoverSlopeConfLow)))
print(paste("Defense Turnovers Exp(Slope Value) High", mean(NewFactorsPlayoffModelDTurnoverSlopeConfHigh)))

print(paste("Defense Free Throw Slope Value", mean(NewFactorsPlayoffModelDFreeThrowSlope)))
print(paste("Defense Free Throw Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelDFreeThrowSlope))))
print(paste("Defense Free Throw Slope Significance", mean(NewFactorsPlayoffModelDFreeThrowSlopeSignificance)))
print(paste("Defense Free Throw Exp(Slope Value) Low", mean(NewFactorsPlayoffModelDFreeThrowSlopeConfLow)))
print(paste("Defense Free Throw Exp(Slope Value) High", mean(NewFactorsPlayoffModelDFreeThrowSlopeConfHigh)))

print(paste("Perason X^2", mean(NewFactorsPlayoffModelPearson)))
print(paste("Critical Value", qchisq(.95, 112)))

```

```{r w/o D_RB%}

NewFactorsPlayoffModelIntercept1 <- numeric(5)
NewFactorsPlayoffModelInterceptSignificance1 <- numeric(5)
NewFactorsPlayoffModelOShootingSlope1 <- numeric(5)
NewFactorsPlayoffModelOShootingSlopeSignificance1 <- numeric(5)
NewFactorsPlayoffModelOTurnoverSlope1 <- numeric(5)
NewFactorsPlayoffModelOTurnoverSlopeSignificance1 <- numeric(5)
NewFactorsPlayoffModelOFreeThrowSlope1 <- numeric(5)
NewFactorsPlayoffModelOFreeThrowSlopeSignificance1 <- numeric(5)
NewFactorsPlayoffModelDShootingSlope1 <- numeric(5)
NewFactorsPlayoffModelDShootingSlopeSignificance1 <- numeric(5)
NewFactorsPlayoffModelDTurnoverSlope1 <- numeric(5)
NewFactorsPlayoffModelDTurnoverSlopeSignificance1 <- numeric(5)
NewFactorsPlayoffModelDFreeThrowSlope1 <- numeric(5)
NewFactorsPlayoffModelDFreeThrowSlopeSignificance1 <- numeric(5)

NewFactorsPlayoffModelConfusionZeroZero1 <- numeric(5)
NewFactorsPlayoffModelConfusionOneZero1 <- numeric(5)
NewFactorsPlayoffModelConfusionZeroOne1 <- numeric(5)
NewFactorsPlayoffModelConfusionOneOne1 <- numeric(5)

for(i in 1:5){ #an iteration for each CV fold
  #Allocating test/training sets for each CV fold
  test <- team_stats[cases[[i]], ]
  training <- team_stats[-cases[[i]], ]
  
  NewFactorsPlayoffModel1 <- glm(formula = Playoff ~ O_eFG_Percent + O_TOV_Percent + O_FT_Per_100_FGA + `D_eFG%` + `D_TOV%` + `D_FT/FGA`, family = binomial(link="logit"), data = training)
  
  NewFactorsPlayoffModelIntercept1[i] <- NewFactorsPlayoffModel1$coefficients[1]
  NewFactorsPlayoffModelInterceptSignificance1[i] <- summary(NewFactorsPlayoffModel1)$coefficients[1, 4]
  NewFactorsPlayoffModelOShootingSlope1[i] <- NewFactorsPlayoffModel1$coefficients[2]
  NewFactorsPlayoffModelOShootingSlopeSignificance1[i] <- summary(NewFactorsPlayoffModel1)$coefficients[2, 4]
  NewFactorsPlayoffModelOTurnoverSlope1[i] <- NewFactorsPlayoffModel1$coefficients[3]
  NewFactorsPlayoffModelOTurnoverSlopeSignificance1[i] <- summary(NewFactorsPlayoffModel1)$coefficients[3, 4]
  NewFactorsPlayoffModelOFreeThrowSlope1[i] <- NewFactorsPlayoffModel1$coefficients[4]
  NewFactorsPlayoffModelOFreeThrowSlopeSignificance1[i] <- summary(NewFactorsPlayoffModel1)$coefficients[4, 4]
  NewFactorsPlayoffModelDShootingSlope1[i] <- NewFactorsPlayoffModel1$coefficients[5]
  NewFactorsPlayoffModelDShootingSlopeSignificance1[i] <- summary(NewFactorsPlayoffModel1)$coefficients[5, 4]
  NewFactorsPlayoffModelDTurnoverSlope1[i] <- NewFactorsPlayoffModel1$coefficients[6]
  NewFactorsPlayoffModelDTurnoverSlopeSignificance1[i] <- summary(NewFactorsPlayoffModel1)$coefficients[6, 4]
  NewFactorsPlayoffModelDFreeThrowSlope1[i] <- NewFactorsPlayoffModel1$coefficients[7]
  NewFactorsPlayoffModelDFreeThrowSlopeSignificance1[i] <- summary(NewFactorsPlayoffModel1)$coefficients[7, 4]
  
  
  test$Prediction1 <- predict(NewFactorsPlayoffModel1, test, type = "response")
  test$Prediction1 <- ifelse(test$Prediction1 > .5, 1, 0)
  
  NewConfusion1 <- table(test$Prediction1, test$Playoff)
  
  NewFactorsPlayoffModelConfusionZeroZero1[i] <- NewConfusion1[1]
  NewFactorsPlayoffModelConfusionOneZero1[i] <- NewConfusion1[2]
  NewFactorsPlayoffModelConfusionZeroOne1[i] <- NewConfusion1[3]
  NewFactorsPlayoffModelConfusionOneOne1[i] <- NewConfusion1[4]

  
}

print(paste("Confusion Zero/Zero", sum(NewFactorsPlayoffModelConfusionZeroZero1)))
print(paste("Confusion One/Zero", sum(NewFactorsPlayoffModelConfusionOneZero1)))
print(paste("Confusion Zero/One", sum(NewFactorsPlayoffModelConfusionZeroOne1)))
print(paste("Confusion One/One", sum(NewFactorsPlayoffModelConfusionOneOne1)))

print(paste("Intercept Value" ,mean(NewFactorsPlayoffModelIntercept1)))
print(paste("Exp(Intercept Value)", exp(mean(NewFactorsPlayoffModelIntercept1))))
print(paste("Intercept Significance", mean(NewFactorsPlayoffModelInterceptSignificance1)))
print(paste("Offense Shooting Slope Value", mean(NewFactorsPlayoffModelOShootingSlope1)))
print(paste("Offense Shooting Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelOShootingSlope1))))
print(paste("Offense Shooting Slope Significance", mean(NewFactorsPlayoffModelOShootingSlopeSignificance1)))
print(paste("Offense Turnovers Slope Value", mean(NewFactorsPlayoffModelOTurnoverSlope1)))
print(paste("Offense Turnovers Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelOTurnoverSlope1))))
print(paste("Offense Turnovers Slope Significance", mean(NewFactorsPlayoffModelOTurnoverSlopeSignificance1)))
print(paste("Offense Free Throw Slope Value", mean(NewFactorsPlayoffModelOFreeThrowSlope1)))
print(paste("Offense Free Throw Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelOFreeThrowSlope1))))
print(paste("Offense Free Throw Slope Significance", mean(NewFactorsPlayoffModelOFreeThrowSlopeSignificance1)))
print(paste("Defense Shooting Slope Value", mean(NewFactorsPlayoffModelDShootingSlope1)))
print(paste("Defense Shooting Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelDShootingSlope1))))
print(paste("Defense Shooting Slope Significance", mean(NewFactorsPlayoffModelDShootingSlopeSignificance1)))
print(paste("Defense Turnovers Slope Value", mean(NewFactorsPlayoffModelDTurnoverSlope1)))
print(paste("Defense Turnovers Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelDTurnoverSlope1))))
print(paste("Defense Turnovers Slope Significance", mean(NewFactorsPlayoffModelDTurnoverSlopeSignificance1)))
print(paste("Defense Free Throw Slope Value", mean(NewFactorsPlayoffModelDFreeThrowSlope1)))
print(paste("Defense Free Throw Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelDFreeThrowSlope1))))
print(paste("Defense Free Throw Slope Significance", mean(NewFactorsPlayoffModelDFreeThrowSlopeSignificance1)))

```

```{r no Freethrow}
NewFactorsPlayoffModelIntercept2 <- numeric(5)
NewFactorsPlayoffModelInterceptSignificance2 <- numeric(5)
NewFactorsPlayoffModelOShootingSlope2 <- numeric(5)
NewFactorsPlayoffModelOShootingSlopeSignificance2 <- numeric(5)
NewFactorsPlayoffModelOTurnoverSlope2 <- numeric(5)
NewFactorsPlayoffModelOTurnoverSlopeSignificance2 <- numeric(5)
NewFactorsPlayoffModelOFreeThrowSlope2 <- numeric(5)
NewFactorsPlayoffModelOFreeThrowSlopeSignificance2 <- numeric(5)
NewFactorsPlayoffModelDShootingSlope2 <- numeric(5)
NewFactorsPlayoffModelDShootingSlopeSignificance2 <- numeric(5)
NewFactorsPlayoffModelDTurnoverSlope2 <- numeric(5)
NewFactorsPlayoffModelDTurnoverSlopeSignificance2 <- numeric(5)

NewFactorsPlayoffModelConfusionZeroZero2 <- numeric(5)
NewFactorsPlayoffModelConfusionOneZero2 <- numeric(5)
NewFactorsPlayoffModelConfusionZeroOne2 <- numeric(5)
NewFactorsPlayoffModelConfusionOneOne2 <- numeric(5)

for(i in 1:5){ #an iteration for each CV fold
  #Allocating test/training sets for each CV fold
  test <- team_stats[cases[[i]], ]
  training <- team_stats[-cases[[i]], ]
  
  NewFactorsPlayoffModel2 <- glm(formula = Playoff ~ O_eFG_Percent + O_TOV_Percent + O_FT_Per_100_FGA + `D_eFG%` + `D_TOV%`, family = binomial(link="logit"), data = training)
  
  NewFactorsPlayoffModelIntercept2[i] <- NewFactorsPlayoffModel2$coefficients[1]
  NewFactorsPlayoffModelInterceptSignificance2[i] <- summary(NewFactorsPlayoffModel2)$coefficients[1, 4]
  NewFactorsPlayoffModelOShootingSlope2[i] <- NewFactorsPlayoffModel2$coefficients[2]
  NewFactorsPlayoffModelOShootingSlopeSignificance2[i] <- summary(NewFactorsPlayoffModel2)$coefficients[2, 4]
  NewFactorsPlayoffModelOTurnoverSlope2[i] <- NewFactorsPlayoffModel2$coefficients[3]
  NewFactorsPlayoffModelOTurnoverSlopeSignificance2[i] <- summary(NewFactorsPlayoffModel2)$coefficients[3, 4]
  NewFactorsPlayoffModelOFreeThrowSlope2[i] <- NewFactorsPlayoffModel2$coefficients[4]
  NewFactorsPlayoffModelOFreeThrowSlopeSignificance2[i] <- summary(NewFactorsPlayoffModel2)$coefficients[4, 4]
  NewFactorsPlayoffModelDShootingSlope2[i] <- NewFactorsPlayoffModel2$coefficients[5]
  NewFactorsPlayoffModelDShootingSlopeSignificance2[i] <- summary(NewFactorsPlayoffModel2)$coefficients[5, 4]
  NewFactorsPlayoffModelDTurnoverSlope2[i] <- NewFactorsPlayoffModel2$coefficients[6]
  NewFactorsPlayoffModelDTurnoverSlopeSignificance2[i] <- summary(NewFactorsPlayoffModel2)$coefficients[6, 4]
  
  test$prediction2 <- predict(NewFactorsPlayoffModel2, test, type="response")
  test$prediction2 <- ifelse(test$prediction2 >0.5, 1, 0)

  NewConfusion2 <- table(test$prediction2, test$Playoff)
  
  NewFactorsPlayoffModelConfusionZeroZero2[i] <- NewConfusion2[1]
  NewFactorsPlayoffModelConfusionOneZero2[i] <- NewConfusion2[2]
  NewFactorsPlayoffModelConfusionZeroOne2[i] <- NewConfusion2[3]
  NewFactorsPlayoffModelConfusionOneOne2[i] <- NewConfusion2[4]

}

print(paste("Confusion Zero/Zero", sum(NewFactorsPlayoffModelConfusionZeroZero2)))
print(paste("Confusion One/Zero", sum(NewFactorsPlayoffModelConfusionOneZero2)))
print(paste("Confusion Zero/One", sum(NewFactorsPlayoffModelConfusionZeroOne2)))
print(paste("Confusion One/One", sum(NewFactorsPlayoffModelConfusionOneOne2)))

print(paste("Intercept Value" ,mean(NewFactorsPlayoffModelIntercept2)))
print(paste("Exp(Intercept Value)", exp(mean(NewFactorsPlayoffModelIntercept2))))
print(paste("Intercept Significance", mean(NewFactorsPlayoffModelInterceptSignificance2)))
print(paste("Offense Shooting Slope Value", mean(NewFactorsPlayoffModelOShootingSlope2)))
print(paste("Offense Shooting Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelOShootingSlope2))))
print(paste("Offense Shooting Slope Significance", mean(NewFactorsPlayoffModelOShootingSlopeSignificance2)))
print(paste("Offense Turnovers Slope Value", mean(NewFactorsPlayoffModelOTurnoverSlope2)))
print(paste("Offense Turnovers Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelOTurnoverSlope2))))
print(paste("Offense Turnovers Slope Significance", mean(NewFactorsPlayoffModelOTurnoverSlopeSignificance2)))
print(paste("Offense Free Throw Slope Value", mean(NewFactorsPlayoffModelOFreeThrowSlope2)))
print(paste("Offense Free Throw Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelOFreeThrowSlope2))))
print(paste("Offense Free Throw Slope Significance", mean(NewFactorsPlayoffModelOFreeThrowSlopeSignificance2)))
print(paste("Defense Shooting Slope Value", mean(NewFactorsPlayoffModelDShootingSlope2)))
print(paste("Defense Shooting Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelDShootingSlope2))))
print(paste("Defense Shooting Slope Significance", mean(NewFactorsPlayoffModelDShootingSlopeSignificance2)))
print(paste("Defense Turnovers Slope Value", mean(NewFactorsPlayoffModelDTurnoverSlope2)))
print(paste("Defense Turnovers Exp(Slope Value)", exp(mean(NewFactorsPlayoffModelDTurnoverSlope2))))
print(paste("Defense Turnovers Slope Significance", mean(NewFactorsPlayoffModelDTurnoverSlopeSignificance2)))`

``` 

```{r}
#Read Data

team_stats <- read.csv("team_stats.csv", header = TRUE)
team_stats$Team <- as.character(team_stats$Team)
```

```{r}
#Fitting models to original data

offensive_four_factors <- lm(ORtg ~ O_eFG_Percent + O_TOV_Percent  + ORB_Percent + O_FT_Per_100_FGA, data = team_stats)
defensive_four_factors <- lm(DRtg ~ D_eFG_Percent + D_TOV_Percent  + DRB_Percent + D_FT_Per_100_FGA, data = team_stats)

summary(offensive_four_factors)
summary(defensive_four_factors)
```


```{r}
# Offensive Regression Model Bootstrapping

#Drawing bootstrap samples
B <- 1000
bootstrap_offensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)
bootstrap_offensive_coeff_reps_sd <- matrix(rep(0, B*4), nrow = B, ncol = 4)

set.seed(1)
for (i in 1:B) {
  boot.sample <- team_stats[sample(nrow(team_stats), 150, replace = TRUE), ] #Create boot sample of size 150
  boot_offensive_four_factors <- lm(ORtg ~ O_eFG_Percent + O_TOV_Percent  + ORB_Percent + O_FT_Per_100_FGA, data = boot.sample) #Evaluating bootstrap replications
  boot.sample_coeff_rep <- as.numeric(boot_offensive_four_factors$coefficients)[2:5]
  bootstrap_offensive_coeff_reps[i,] <- boot.sample_coeff_rep 
  bootstrap_offensive_coeff_reps_sd[i,] <-as.numeric(coef(summary(boot_offensive_four_factors))[2:5, 2])
}
```

```{r}
#Standard Error for bootstrap replication coefficients of offensive model (Chapter 2 Slide 9/10)

offensive_shooting_seB <- sd(bootstrap_offensive_coeff_reps[,1])
offensive_turnovers_seB <- sd(bootstrap_offensive_coeff_reps[,2])
offensive_rebounding_seB <- sd(bootstrap_offensive_coeff_reps[,3])
offensive_free_throw_seB <- sd(bootstrap_offensive_coeff_reps[,4])

print(offensive_shooting_seB)
print(offensive_turnovers_seB)
print(offensive_rebounding_seB)
print(offensive_free_throw_seB)

```

```{r}
#Default confidence intervals for offensive four factors
confint(offensive_four_factors, level = .95)
```

```{r}
#Construct bootstrap-t interval offensive four factors
boot.offensive.shooting.pivot.approx <- (bootstrap_offensive_coeff_reps[,1] - offensive_four_factors$coefficients[2]) / bootstrap_offensive_coeff_reps_sd[,1]
boot.offensive.shooting.that.low <- quantile(boot.offensive.shooting.pivot.approx, 1 - alpha)
boot.offensive.shooting.that.high <- quantile(boot.offensive.shooting.pivot.approx, alpha)
offensive.shooting.boot.t.confint.low <- offensive_four_factors$coefficients[2] - boot.offensive.shooting.that.low * coef(summary(boot_offensive_four_factors))[2, 2]
offensive.shooting.boot.t.confint.high <- offensive_four_factors$coefficients[2] - boot.offensive.shooting.that.high * coef(summary(boot_offensive_four_factors))[2, 2]
print(offensive.shooting.boot.t.confint.low)
print(offensive.shooting.boot.t.confint.high)

boot.offensive.turnover.pivot.approx <- (bootstrap_offensive_coeff_reps[,2] - offensive_four_factors$coefficients[3]) / bootstrap_offensive_coeff_reps_sd[,2]
boot.offensive.turnover.that.low <- quantile(boot.offensive.turnover.pivot.approx, 1 - alpha)
boot.offensive.turnover.that.high <- quantile(boot.offensive.turnover.pivot.approx, alpha)
offensive.turnover.boot.t.confint.low <- offensive_four_factors$coefficients[3] - boot.offensive.turnover.that.low * coef(summary(boot_offensive_four_factors))[3, 2]
offensive.turnover.boot.t.confint.high <- offensive_four_factors$coefficients[3] - boot.offensive.turnover.that.high * coef(summary(boot_offensive_four_factors))[3, 2]
print(offensive.turnover.boot.t.confint.low)
print(offensive.turnover.boot.t.confint.high)

boot.offensive.rebounding.pivot.approx <- (bootstrap_offensive_coeff_reps[,3] - offensive_four_factors$coefficients[4]) / bootstrap_offensive_coeff_reps_sd[,3]
boot.offensive.rebounding.that.low <- quantile(boot.offensive.rebounding.pivot.approx, 1 - alpha)
boot.offensive.rebounding.that.high <- quantile(boot.offensive.rebounding.pivot.approx, alpha)
offensive.rebounding.boot.t.confint.low <- offensive_four_factors$coefficients[4] - boot.offensive.rebounding.that.low * coef(summary(boot_offensive_four_factors))[4, 2]
offensive.rebounding.boot.t.confint.high <- offensive_four_factors$coefficients[4] - boot.offensive.rebounding.that.high * coef(summary(boot_offensive_four_factors))[4, 2]
print(offensive.rebounding.boot.t.confint.low)
print(offensive.rebounding.boot.t.confint.high)

boot.offensive.free.throw.pivot.approx <- (bootstrap_offensive_coeff_reps[,4] - offensive_four_factors$coefficients[5]) / bootstrap_offensive_coeff_reps_sd[,4]
boot.offensive.free.throw.that.low <- quantile(boot.offensive.free.throw.pivot.approx, 1 - alpha)
boot.offensive.free.throw.that.high <- quantile(boot.offensive.free.throw.pivot.approx, alpha)
offensive.free.throw.boot.t.confint.low <- offensive_four_factors$coefficients[5] - boot.offensive.free.throw.that.low * coef(summary(boot_offensive_four_factors))[5, 2]
offensive.free.throw.boot.t.confint.high <- offensive_four_factors$coefficients[5] - boot.offensive.free.throw.that.high * coef(summary(boot_offensive_four_factors))[5, 2]
print(offensive.free.throw.boot.t.confint.low)
print(offensive.free.throw.boot.t.confint.high)
```


```{r}
# Construct percentile intervals for offensive four factors (Chapter 5 Slide 9)

alpha <- .025
offensive_shooting_CI_low <- quantile(bootstrap_offensive_coeff_reps[,1], alpha)
offensive_shooting_CI_high <- quantile(bootstrap_offensive_coeff_reps[,1], 1 - alpha)
offensive_shooting_CI <- c(offensive_shooting_CI_low, offensive_shooting_CI_high)
offensive_turnovers_CI_low <- quantile(bootstrap_offensive_coeff_reps[,2], alpha)
offensive_turnovers_CI_high <- quantile(bootstrap_offensive_coeff_reps[,2], 1 - alpha)
offensive_turnovers_CI <- c(offensive_turnovers_CI_low, offensive_turnovers_CI_high)
offensive_rebounding_CI_low <- quantile(bootstrap_offensive_coeff_reps[,3], alpha)
offensive_rebounding_CI_high <- quantile(bootstrap_offensive_coeff_reps[,3], 1 - alpha)
offensive_rebounding_CI <- c(offensive_rebounding_CI_low, offensive_rebounding_CI_high)
offensive_free_throw_CI_low <- quantile(bootstrap_offensive_coeff_reps[,4], alpha)
offensive_free_throw_CI_high <- quantile(bootstrap_offensive_coeff_reps[,4], 1 - alpha) 
offensive_free_throw_CI <- c(offensive_free_throw_CI_low, offensive_free_throw_CI_high)

print(offensive_shooting_CI)
print(offensive_turnovers_CI)
print(offensive_rebounding_CI)
print(offensive_free_throw_CI)
```

```{r}
# Defensive Regression Model Bootstrapping

#Drawing bootstrap samples
B <- 1000
bootstrap_defensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)
bootstrap_defensive_coeff_reps_sd <- matrix(rep(0, B*4), nrow = B, ncol = 4)


set.seed(1)
for (i in 1:B) {
  boot.sample <- team_stats[sample(nrow(team_stats), 150, replace = TRUE), ] #Create boot sample of size 150
  boot_defensive_four_factors <- lm(DRtg ~ D_eFG_Percent + D_TOV_Percent  + DRB_Percent + D_FT_Per_100_FGA, data = boot.sample) #Evaluating bootstrap replications
  boot.sample_coeff_rep <- as.numeric(boot_defensive_four_factors$coefficients)[2:5]
  bootstrap_defensive_coeff_reps[i,] <- boot.sample_coeff_rep 
  bootstrap_defensive_coeff_reps_sd[i,] <-as.numeric(coef(summary(boot_defensive_four_factors))[2:5, 2])
}
```

```{r}
#Standard Error of bootstrap replication coefficients for defensive model (Chapter 2 Slide 9/10)

defensive_shooting_seB <- sd(bootstrap_defensive_coeff_reps[,1])
defensive_turnovers_seB <- sd(bootstrap_defensive_coeff_reps[,2])
defensive_rebounding_seB <- sd(bootstrap_defensive_coeff_reps[,3])
defensive_free_throw_seB <- sd(bootstrap_defensive_coeff_reps[,4])

print(defensive_shooting_seB)
print(defensive_turnovers_seB)
print(defensive_rebounding_seB)
print(defensive_free_throw_seB)


```

```{r}
#Default confidence intervals for defensive four factors
confint(defensive_four_factors, level = .95)
```

```{r}
# Construct percentile intervals for defensive four factors (Chapter 5 Slide 9)

alpha <- .025
defensive_shooting_CI_low <- quantile(bootstrap_defensive_coeff_reps[,1], alpha)
defensive_shooting_CI_high <- quantile(bootstrap_defensive_coeff_reps[,1], 1 - alpha)
defensive_shooting_CI <- c(defensive_shooting_CI_low, defensive_shooting_CI_high)
defensive_turnovers_CI_low <- quantile(bootstrap_defensive_coeff_reps[,2], alpha)
defensive_turnovers_CI_high <- quantile(bootstrap_defensive_coeff_reps[,2], 1 - alpha)
defensive_turnovers_CI <- c(defensive_turnovers_CI_low, defensive_turnovers_CI_high)
defensive_rebounding_CI_low <- quantile(bootstrap_defensive_coeff_reps[,3], alpha)
defensive_rebounding_CI_high <- quantile(bootstrap_defensive_coeff_reps[,3], 1 - alpha)
defensive_rebounding_CI <- c(defensive_rebounding_CI_low, defensive_rebounding_CI_high)
defensive_free_throw_CI_low <- quantile(bootstrap_defensive_coeff_reps[,4], alpha)
defensive_free_throw_CI_high <- quantile(bootstrap_defensive_coeff_reps[,4], 1 - alpha) 
defensive_free_throw_CI <- c(defensive_free_throw_CI_low, defensive_free_throw_CI_high)

print(defensive_shooting_CI)
print(defensive_turnovers_CI)
print(defensive_rebounding_CI)
print(defensive_free_throw_CI)
```

```{r}
#Construct bootstrap-t interval defensive four factors
boot.defensive.shooting.pivot.approx <- (bootstrap_defensive_coeff_reps[,1] - defensive_four_factors$coefficients[2]) / bootstrap_defensive_coeff_reps_sd[,1]
boot.defensive.shooting.that.low <- quantile(boot.defensive.shooting.pivot.approx, 1 - alpha)
boot.defensive.shooting.that.high <- quantile(boot.defensive.shooting.pivot.approx, alpha)
defensive.shooting.boot.t.confint.low <- defensive_four_factors$coefficients[2] - boot.defensive.shooting.that.low * coef(summary(boot_defensive_four_factors))[2, 2]
defensive.shooting.boot.t.confint.high <- defensive_four_factors$coefficients[2] - boot.defensive.shooting.that.high * coef(summary(boot_defensive_four_factors))[2, 2]
print(defensive.shooting.boot.t.confint.low)
print(defensive.shooting.boot.t.confint.high)

boot.defensive.turnover.pivot.approx <- (bootstrap_defensive_coeff_reps[,2] - defensive_four_factors$coefficients[3]) / bootstrap_defensive_coeff_reps_sd[,2]
boot.defensive.turnover.that.low <- quantile(boot.defensive.turnover.pivot.approx, 1 - alpha)
boot.defensive.turnover.that.high <- quantile(boot.defensive.turnover.pivot.approx, alpha)
defensive.turnover.boot.t.confint.low <- defensive_four_factors$coefficients[3] - boot.defensive.turnover.that.low * coef(summary(boot_defensive_four_factors))[3, 2]
defensive.turnover.boot.t.confint.high <- defensive_four_factors$coefficients[3] - boot.defensive.turnover.that.high * coef(summary(boot_defensive_four_factors))[3, 2]
print(defensive.turnover.boot.t.confint.low)
print(defensive.turnover.boot.t.confint.high)

boot.defensive.rebounding.pivot.approx <- (bootstrap_defensive_coeff_reps[,3] - defensive_four_factors$coefficients[4]) / bootstrap_defensive_coeff_reps_sd[,3]
boot.defensive.rebounding.that.low <- quantile(boot.defensive.rebounding.pivot.approx, 1 - alpha)
boot.defensive.rebounding.that.high <- quantile(boot.defensive.rebounding.pivot.approx, alpha)
defensive.rebounding.boot.t.confint.low <- defensive_four_factors$coefficients[4] - boot.defensive.rebounding.that.low * coef(summary(boot_defensive_four_factors))[4, 2]
defensive.rebounding.boot.t.confint.high <- defensive_four_factors$coefficients[4] - boot.defensive.rebounding.that.high * coef(summary(boot_defensive_four_factors))[4, 2]
print(defensive.rebounding.boot.t.confint.low)
print(defensive.rebounding.boot.t.confint.high)

boot.defensive.free.throw.pivot.approx <- (bootstrap_defensive_coeff_reps[,4] - defensive_four_factors$coefficients[5]) / bootstrap_defensive_coeff_reps_sd[,4]
boot.defensive.free.throw.that.low <- quantile(boot.defensive.free.throw.pivot.approx, 1 - alpha)
boot.defensive.free.throw.that.high <- quantile(boot.defensive.free.throw.pivot.approx, alpha)
defensive.free.throw.boot.t.confint.low <- defensive_four_factors$coefficients[5] - boot.defensive.free.throw.that.low * coef(summary(boot_defensive_four_factors))[5, 2]
defensive.free.throw.boot.t.confint.high <- defensive_four_factors$coefficients[5] - boot.defensive.free.throw.that.high * coef(summary(boot_defensive_four_factors))[5, 2]
print(defensive.free.throw.boot.t.confint.low)
print(defensive.free.throw.boot.t.confint.high)
```

```{r} 
#Bootstrapping Per Season Offensive Models
twelve_thirteen_stats <- team_stats[which(grepl("12-13", team_stats$Team)),]
thirteen_fourteen_stats <- team_stats[which(grepl("13-14", team_stats$Team)),]
fourteen_fifteen_stats <- team_stats[which(grepl("14-15", team_stats$Team)),]
fifteen_sixteen_stats <- team_stats[which(grepl("15-16", team_stats$Team)),]
sixteen_seventeen_stats <- team_stats[which(grepl("16-17", team_stats$Team)),]

twelve.thirteen.bootstrap_offensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)
thirteen.fourteen.bootstrap_offensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)
fourteen.fifteen.bootstrap_offensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)
fifteen.sixteen.bootstrap_offensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)
sixteen.seventeen.bootstrap_offensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)

for (i in 1:B) {
  twelve.thirteen.boot.sample <- team_stats[sample(nrow(twelve_thirteen_stats), 30, replace = TRUE), ]
  twelve.thirteen.boot_offensive_four_factors <- lm(ORtg ~ O_eFG_Percent + O_TOV_Percent  + ORB_Percent + O_FT_Per_100_FGA, data = twelve.thirteen.boot.sample) #Evaluating bootstrap replications
  twelve.thirteen.boot.sample_coeff_rep <- as.numeric(twelve.thirteen.boot_offensive_four_factors$coefficients)[2:5]
  twelve.thirteen.bootstrap_offensive_coeff_reps[i,] <- twelve.thirteen.boot.sample_coeff_rep
  
  thirteen.fourteen.boot.sample <- team_stats[sample(nrow(thirteen_fourteen_stats), 30, replace = TRUE), ]
  thirteen.fourteen.boot_offensive_four_factors <- lm(ORtg ~ O_eFG_Percent + O_TOV_Percent  + ORB_Percent + O_FT_Per_100_FGA, data = thirteen.fourteen.boot.sample) #Evaluating bootstrap replications
  thirteen.fourteen.boot.sample_coeff_rep <- as.numeric(thirteen.fourteen.boot_offensive_four_factors$coefficients)[2:5]
  thirteen.fourteen.bootstrap_offensive_coeff_reps[i,] <- thirteen.fourteen.boot.sample_coeff_rep
  
  fourteen.fifteen.boot.sample <- team_stats[sample(nrow(fourteen_fifteen_stats), 30, replace = TRUE), ]
  fourteen.fifteen.boot_offensive_four_factors <- lm(ORtg ~ O_eFG_Percent + O_TOV_Percent  + ORB_Percent + O_FT_Per_100_FGA, data = fourteen.fifteen.boot.sample) #Evaluating bootstrap replications
  fourteen.fifteen.boot.sample_coeff_rep <- as.numeric(fourteen.fifteen.boot_offensive_four_factors$coefficients)[2:5]
  fourteen.fifteen.bootstrap_offensive_coeff_reps[i,] <- fourteen.fifteen.boot.sample_coeff_rep
  
  fifteen.sixteen.boot.sample <- team_stats[sample(nrow(fifteen_sixteen_stats), 30, replace = TRUE), ]
  fifteen.sixteen.boot_offensive_four_factors <- lm(ORtg ~ O_eFG_Percent + O_TOV_Percent  + ORB_Percent + O_FT_Per_100_FGA, data = fifteen.sixteen.boot.sample) #Evaluating bootstrap replications
  fifteen.sixteen.boot.sample_coeff_rep <- as.numeric(fifteen.sixteen.boot_offensive_four_factors$coefficients)[2:5]
  fifteen.sixteen.bootstrap_offensive_coeff_reps[i,] <- fifteen.sixteen.boot.sample_coeff_rep
  
  sixteen.seventeen.boot.sample <- team_stats[sample(nrow(sixteen_seventeen_stats), 30, replace = TRUE), ]
  sixteen.seventeen.boot_offensive_four_factors <- lm(ORtg ~ O_eFG_Percent + O_TOV_Percent  + ORB_Percent + O_FT_Per_100_FGA, data = sixteen.seventeen.boot.sample) #Evaluating bootstrap replications
  sixteen.seventeen.boot.sample_coeff_rep <- as.numeric(sixteen.seventeen.boot_offensive_four_factors$coefficients)[2:5]
  sixteen.seventeen.bootstrap_offensive_coeff_reps[i,] <- sixteen.seventeen.boot.sample_coeff_rep
}

#Standard Errors/Confidence Intervals Per Season

#twelve.thirteen

twelve.thirteen.offensive_shooting_seB <- sd(twelve.thirteen.bootstrap_offensive_coeff_reps[,1])
twelve.thirteen.offensive_turnovers_seB <- sd(twelve.thirteen.bootstrap_offensive_coeff_reps[,2])
twelve.thirteen.offensive_rebounding_seB <- sd(twelve.thirteen.bootstrap_offensive_coeff_reps[,3])
twelve.thirteen.offensive_free_throw_seB <- sd(bootstrap_offensive_coeff_reps[,4])

print(twelve.thirteen.offensive_shooting_seB)
print(twelve.thirteen.offensive_turnovers_seB)
print(twelve.thirteen.offensive_rebounding_seB)
print(twelve.thirteen.offensive_free_throw_seB)

twelve.thirteen.offensive_shooting_CI_low <- quantile(twelve.thirteen.bootstrap_offensive_coeff_reps[,1], alpha)
twelve.thirteen.offensive_shooting_CI_high <- quantile(twelve.thirteen.bootstrap_offensive_coeff_reps[,1], 1 - alpha)
twelve.thirteen.offensive_shooting_CI <- c(twelve.thirteen.offensive_shooting_CI_low, twelve.thirteen.offensive_shooting_CI_high)
twelve.thirteen.offensive_turnovers_CI_low <- quantile(twelve.thirteen.bootstrap_offensive_coeff_reps[,2], alpha)
twelve.thirteen.offensive_turnovers_CI_high <- quantile(twelve.thirteen.bootstrap_offensive_coeff_reps[,2], 1 - alpha)
twelve.thirteen.offensive_turnovers_CI <- c(twelve.thirteen.offensive_turnovers_CI_low, twelve.thirteen.offensive_turnovers_CI_high)
twelve.thirteen.offensive_rebounding_CI_low <- quantile(twelve.thirteen.bootstrap_offensive_coeff_reps[,3], alpha)
twelve.thirteen.offensive_rebounding_CI_high <- quantile(twelve.thirteen.bootstrap_offensive_coeff_reps[,3], 1 - alpha)
twelve.thirteen.offensive_rebounding_CI <- c(twelve.thirteen.offensive_rebounding_CI_low, twelve.thirteen.offensive_rebounding_CI_high)
twelve.thirteen.offensive_free_throw_CI_low <- quantile(twelve.thirteen.bootstrap_offensive_coeff_reps[,4], alpha)
twelve.thirteen.offensive_free_throw_CI_high <- quantile(twelve.thirteen.bootstrap_offensive_coeff_reps[,4], 1 - alpha) 
twelve.thirteen.offensive_free_throw_CI <- c(twelve.thirteen.offensive_free_throw_CI_low, twelve.thirteen.offensive_free_throw_CI_high)

print(twelve.thirteen.offensive_shooting_CI)
print(twelve.thirteen.offensive_turnovers_CI)
print(twelve.thirteen.offensive_rebounding_CI)
print(twelve.thirteen.offensive_free_throw_CI)

#thirteen.fourteen

thirteen.fourteen.offensive_shooting_seB <- sd(thirteen.fourteen.bootstrap_offensive_coeff_reps[,1])
thirteen.fourteen.offensive_turnovers_seB <- sd(thirteen.fourteen.bootstrap_offensive_coeff_reps[,2])
thirteen.fourteen.offensive_rebounding_seB <- sd(thirteen.fourteen.bootstrap_offensive_coeff_reps[,3])
thirteen.fourteen.offensive_free_throw_seB <- sd(bootstrap_offensive_coeff_reps[,4])

print(thirteen.fourteen.offensive_shooting_seB)
print(thirteen.fourteen.offensive_turnovers_seB)
print(thirteen.fourteen.offensive_rebounding_seB)
print(thirteen.fourteen.offensive_free_throw_seB)

thirteen.fourteen.offensive_shooting_CI_low <- quantile(thirteen.fourteen.bootstrap_offensive_coeff_reps[,1], alpha)
thirteen.fourteen.offensive_shooting_CI_high <- quantile(thirteen.fourteen.bootstrap_offensive_coeff_reps[,1], 1 - alpha)
thirteen.fourteen.offensive_shooting_CI <- c(thirteen.fourteen.offensive_shooting_CI_low, thirteen.fourteen.offensive_shooting_CI_high)
thirteen.fourteen.offensive_turnovers_CI_low <- quantile(thirteen.fourteen.bootstrap_offensive_coeff_reps[,2], alpha)
thirteen.fourteen.offensive_turnovers_CI_high <- quantile(thirteen.fourteen.bootstrap_offensive_coeff_reps[,2], 1 - alpha)
thirteen.fourteen.offensive_turnovers_CI <- c(thirteen.fourteen.offensive_turnovers_CI_low, thirteen.fourteen.offensive_turnovers_CI_high)
thirteen.fourteen.offensive_rebounding_CI_low <- quantile(thirteen.fourteen.bootstrap_offensive_coeff_reps[,3], alpha)
thirteen.fourteen.offensive_rebounding_CI_high <- quantile(thirteen.fourteen.bootstrap_offensive_coeff_reps[,3], 1 - alpha)
thirteen.fourteen.offensive_rebounding_CI <- c(thirteen.fourteen.offensive_rebounding_CI_low, thirteen.fourteen.offensive_rebounding_CI_high)
thirteen.fourteen.offensive_free_throw_CI_low <- quantile(thirteen.fourteen.bootstrap_offensive_coeff_reps[,4], alpha)
thirteen.fourteen.offensive_free_throw_CI_high <- quantile(thirteen.fourteen.bootstrap_offensive_coeff_reps[,4], 1 - alpha) 
thirteen.fourteen.offensive_free_throw_CI <- c(thirteen.fourteen.offensive_free_throw_CI_low, thirteen.fourteen.offensive_free_throw_CI_high)

print(thirteen.fourteen.offensive_shooting_CI)
print(thirteen.fourteen.offensive_turnovers_CI)
print(thirteen.fourteen.offensive_rebounding_CI)
print(thirteen.fourteen.offensive_free_throw_CI)

#fourteen.fifteen

fourteen.fifteen.offensive_shooting_seB <- sd(fourteen.fifteen.bootstrap_offensive_coeff_reps[,1])
fourteen.fifteen.offensive_turnovers_seB <- sd(fourteen.fifteen.bootstrap_offensive_coeff_reps[,2])
fourteen.fifteen.offensive_rebounding_seB <- sd(fourteen.fifteen.bootstrap_offensive_coeff_reps[,3])
fourteen.fifteen.offensive_free_throw_seB <- sd(bootstrap_offensive_coeff_reps[,4])

print(fourteen.fifteen.offensive_shooting_seB)
print(fourteen.fifteen.offensive_turnovers_seB)
print(fourteen.fifteen.offensive_rebounding_seB)
print(fourteen.fifteen.offensive_free_throw_seB)

fourteen.fifteen.offensive_shooting_CI_low <- quantile(fourteen.fifteen.bootstrap_offensive_coeff_reps[,1], alpha)
fourteen.fifteen.offensive_shooting_CI_high <- quantile(fourteen.fifteen.bootstrap_offensive_coeff_reps[,1], 1 - alpha)
fourteen.fifteen.offensive_shooting_CI <- c(fourteen.fifteen.offensive_shooting_CI_low, fourteen.fifteen.offensive_shooting_CI_high)
fourteen.fifteen.offensive_turnovers_CI_low <- quantile(fourteen.fifteen.bootstrap_offensive_coeff_reps[,2], alpha)
fourteen.fifteen.offensive_turnovers_CI_high <- quantile(fourteen.fifteen.bootstrap_offensive_coeff_reps[,2], 1 - alpha)
fourteen.fifteen.offensive_turnovers_CI <- c(fourteen.fifteen.offensive_turnovers_CI_low, fourteen.fifteen.offensive_turnovers_CI_high)
fourteen.fifteen.offensive_rebounding_CI_low <- quantile(fourteen.fifteen.bootstrap_offensive_coeff_reps[,3], alpha)
fourteen.fifteen.offensive_rebounding_CI_high <- quantile(fourteen.fifteen.bootstrap_offensive_coeff_reps[,3], 1 - alpha)
fourteen.fifteen.offensive_rebounding_CI <- c(fourteen.fifteen.offensive_rebounding_CI_low, fourteen.fifteen.offensive_rebounding_CI_high)
fourteen.fifteen.offensive_free_throw_CI_low <- quantile(fourteen.fifteen.bootstrap_offensive_coeff_reps[,4], alpha)
fourteen.fifteen.offensive_free_throw_CI_high <- quantile(fourteen.fifteen.bootstrap_offensive_coeff_reps[,4], 1 - alpha) 
fourteen.fifteen.offensive_free_throw_CI <- c(fourteen.fifteen.offensive_free_throw_CI_low, fourteen.fifteen.offensive_free_throw_CI_high)

print(fourteen.fifteen.offensive_shooting_CI)
print(fourteen.fifteen.offensive_turnovers_CI)
print(fourteen.fifteen.offensive_rebounding_CI)
print(fourteen.fifteen.offensive_free_throw_CI)

#fifteen.sixteen

fifteen.sixteen.offensive_shooting_seB <- sd(fifteen.sixteen.bootstrap_offensive_coeff_reps[,1])
fifteen.sixteen.offensive_turnovers_seB <- sd(fifteen.sixteen.bootstrap_offensive_coeff_reps[,2])
fifteen.sixteen.offensive_rebounding_seB <- sd(fifteen.sixteen.bootstrap_offensive_coeff_reps[,3])
fifteen.sixteen.offensive_free_throw_seB <- sd(bootstrap_offensive_coeff_reps[,4])

print(fifteen.sixteen.offensive_shooting_seB)
print(fifteen.sixteen.offensive_turnovers_seB)
print(fifteen.sixteen.offensive_rebounding_seB)
print(fifteen.sixteen.offensive_free_throw_seB)

fifteen.sixteen.offensive_shooting_CI_low <- quantile(fifteen.sixteen.bootstrap_offensive_coeff_reps[,1], alpha)
fifteen.sixteen.offensive_shooting_CI_high <- quantile(fifteen.sixteen.bootstrap_offensive_coeff_reps[,1], 1 - alpha)
fifteen.sixteen.offensive_shooting_CI <- c(fifteen.sixteen.offensive_shooting_CI_low, fifteen.sixteen.offensive_shooting_CI_high)
fifteen.sixteen.offensive_turnovers_CI_low <- quantile(fifteen.sixteen.bootstrap_offensive_coeff_reps[,2], alpha)
fifteen.sixteen.offensive_turnovers_CI_high <- quantile(fifteen.sixteen.bootstrap_offensive_coeff_reps[,2], 1 - alpha)
fifteen.sixteen.offensive_turnovers_CI <- c(fifteen.sixteen.offensive_turnovers_CI_low, fifteen.sixteen.offensive_turnovers_CI_high)
fifteen.sixteen.offensive_rebounding_CI_low <- quantile(fifteen.sixteen.bootstrap_offensive_coeff_reps[,3], alpha)
fifteen.sixteen.offensive_rebounding_CI_high <- quantile(fifteen.sixteen.bootstrap_offensive_coeff_reps[,3], 1 - alpha)
fifteen.sixteen.offensive_rebounding_CI <- c(fifteen.sixteen.offensive_rebounding_CI_low, fifteen.sixteen.offensive_rebounding_CI_high)
fifteen.sixteen.offensive_free_throw_CI_low <- quantile(fifteen.sixteen.bootstrap_offensive_coeff_reps[,4], alpha)
fifteen.sixteen.offensive_free_throw_CI_high <- quantile(fifteen.sixteen.bootstrap_offensive_coeff_reps[,4], 1 - alpha) 
fifteen.sixteen.offensive_free_throw_CI <- c(fifteen.sixteen.offensive_free_throw_CI_low, fifteen.sixteen.offensive_free_throw_CI_high)

print(fifteen.sixteen.offensive_shooting_CI)
print(fifteen.sixteen.offensive_turnovers_CI)
print(fifteen.sixteen.offensive_rebounding_CI)
print(fifteen.sixteen.offensive_free_throw_CI)

#sixteen.seventeen

sixteen.seventeen.offensive_shooting_seB <- sd(sixteen.seventeen.bootstrap_offensive_coeff_reps[,1])
sixteen.seventeen.offensive_turnovers_seB <- sd(sixteen.seventeen.bootstrap_offensive_coeff_reps[,2])
sixteen.seventeen.offensive_rebounding_seB <- sd(sixteen.seventeen.bootstrap_offensive_coeff_reps[,3])
sixteen.seventeen.offensive_free_throw_seB <- sd(bootstrap_offensive_coeff_reps[,4])

print(sixteen.seventeen.offensive_shooting_seB)
print(sixteen.seventeen.offensive_turnovers_seB)
print(sixteen.seventeen.offensive_rebounding_seB)
print(sixteen.seventeen.offensive_free_throw_seB)

sixteen.seventeen.offensive_shooting_CI_low <- quantile(sixteen.seventeen.bootstrap_offensive_coeff_reps[,1], alpha)
sixteen.seventeen.offensive_shooting_CI_high <- quantile(sixteen.seventeen.bootstrap_offensive_coeff_reps[,1], 1 - alpha)
sixteen.seventeen.offensive_shooting_CI <- c(sixteen.seventeen.offensive_shooting_CI_low, sixteen.seventeen.offensive_shooting_CI_high)
sixteen.seventeen.offensive_turnovers_CI_low <- quantile(sixteen.seventeen.bootstrap_offensive_coeff_reps[,2], alpha)
sixteen.seventeen.offensive_turnovers_CI_high <- quantile(sixteen.seventeen.bootstrap_offensive_coeff_reps[,2], 1 - alpha)
sixteen.seventeen.offensive_turnovers_CI <- c(sixteen.seventeen.offensive_turnovers_CI_low, sixteen.seventeen.offensive_turnovers_CI_high)
sixteen.seventeen.offensive_rebounding_CI_low <- quantile(sixteen.seventeen.bootstrap_offensive_coeff_reps[,3], alpha)
sixteen.seventeen.offensive_rebounding_CI_high <- quantile(sixteen.seventeen.bootstrap_offensive_coeff_reps[,3], 1 - alpha)
sixteen.seventeen.offensive_rebounding_CI <- c(sixteen.seventeen.offensive_rebounding_CI_low, sixteen.seventeen.offensive_rebounding_CI_high)
sixteen.seventeen.offensive_free_throw_CI_low <- quantile(sixteen.seventeen.bootstrap_offensive_coeff_reps[,4], alpha)
sixteen.seventeen.offensive_free_throw_CI_high <- quantile(sixteen.seventeen.bootstrap_offensive_coeff_reps[,4], 1 - alpha) 
sixteen.seventeen.offensive_free_throw_CI <- c(sixteen.seventeen.offensive_free_throw_CI_low, sixteen.seventeen.offensive_free_throw_CI_high)

print(sixteen.seventeen.offensive_shooting_CI)
print(sixteen.seventeen.offensive_turnovers_CI)
print(sixteen.seventeen.offensive_rebounding_CI)
print(sixteen.seventeen.offensive_free_throw_CI)
```

```{r}
#Boostrapping defensive models per season

twelve.thirteen.bootstrap_defensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)
thirteen.fourteen.bootstrap_defensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)
fourteen.fifteen.bootstrap_defensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)
fifteen.sixteen.bootstrap_defensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)
sixteen.seventeen.bootstrap_defensive_coeff_reps <- matrix(rep(0,B*4), nrow = B, ncol = 4)

for (i in 1:B) {
  twelve.thirteen.boot.sample <- team_stats[sample(nrow(twelve_thirteen_stats), 30, replace = TRUE), ]
  twelve.thirteen.boot_defensive_four_factors <- lm(DRtg ~ D_eFG_Percent + D_TOV_Percent  + DRB_Percent + D_FT_Per_100_FGA, data = twelve.thirteen.boot.sample) #Evaluating bootstrap replications
  twelve.thirteen.boot.sample_coeff_rep <- as.numeric(twelve.thirteen.boot_defensive_four_factors$coefficients)[2:5]
  twelve.thirteen.bootstrap_defensive_coeff_reps[i,] <- twelve.thirteen.boot.sample_coeff_rep
  
  thirteen.fourteen.boot.sample <- team_stats[sample(nrow(thirteen_fourteen_stats), 30, replace = TRUE), ]
  thirteen.fourteen.boot_defensive_four_factors <- lm(DRtg ~ D_eFG_Percent + D_TOV_Percent  + DRB_Percent + D_FT_Per_100_FGA, data = thirteen.fourteen.boot.sample) #Evaluating bootstrap replications
  thirteen.fourteen.boot.sample_coeff_rep <- as.numeric(thirteen.fourteen.boot_defensive_four_factors$coefficients)[2:5]
  thirteen.fourteen.bootstrap_defensive_coeff_reps[i,] <- thirteen.fourteen.boot.sample_coeff_rep
  
  fourteen.fifteen.boot.sample <- team_stats[sample(nrow(fourteen_fifteen_stats), 30, replace = TRUE), ]
  fourteen.fifteen.boot_defensive_four_factors <- lm(DRtg ~ D_eFG_Percent + D_TOV_Percent  + DRB_Percent + D_FT_Per_100_FGA, data = fourteen.fifteen.boot.sample) #Evaluating bootstrap replications
  fourteen.fifteen.boot.sample_coeff_rep <- as.numeric(fourteen.fifteen.boot_defensive_four_factors$coefficients)[2:5]
  fourteen.fifteen.bootstrap_defensive_coeff_reps[i,] <- fourteen.fifteen.boot.sample_coeff_rep
  
  fifteen.sixteen.boot.sample <- team_stats[sample(nrow(fifteen_sixteen_stats), 30, replace = TRUE), ]
  fifteen.sixteen.boot_defensive_four_factors <- lm(DRtg ~ D_eFG_Percent + D_TOV_Percent  + DRB_Percent + D_FT_Per_100_FGA, data = fifteen.sixteen.boot.sample) #Evaluating bootstrap replications
  fifteen.sixteen.boot.sample_coeff_rep <- as.numeric(fifteen.sixteen.boot_defensive_four_factors$coefficients)[2:5]
  fifteen.sixteen.bootstrap_defensive_coeff_reps[i,] <- fifteen.sixteen.boot.sample_coeff_rep
  
  sixteen.seventeen.boot.sample <- team_stats[sample(nrow(sixteen_seventeen_stats), 30, replace = TRUE), ]
  sixteen.seventeen.boot_defensive_four_factors <- lm(DRtg ~ D_eFG_Percent + D_TOV_Percent  + DRB_Percent + D_FT_Per_100_FGA, data = sixteen.seventeen.boot.sample) #Evaluating bootstrap replications
  sixteen.seventeen.boot.sample_coeff_rep <- as.numeric(sixteen.seventeen.boot_defensive_four_factors$coefficients)[2:5]
  sixteen.seventeen.bootstrap_defensive_coeff_reps[i,] <- sixteen.seventeen.boot.sample_coeff_rep
}

#Standard Errors/Confidence Intervals Per Season

#twelve.thirteen

twelve.thirteen.defensive_shooting_seB <- sd(twelve.thirteen.bootstrap_defensive_coeff_reps[,1])
twelve.thirteen.defensive_turnovers_seB <- sd(twelve.thirteen.bootstrap_defensive_coeff_reps[,2])
twelve.thirteen.defensive_rebounding_seB <- sd(twelve.thirteen.bootstrap_defensive_coeff_reps[,3])
twelve.thirteen.defensive_free_throw_seB <- sd(bootstrap_defensive_coeff_reps[,4])

print(twelve.thirteen.defensive_shooting_seB)
print(twelve.thirteen.defensive_turnovers_seB)
print(twelve.thirteen.defensive_rebounding_seB)
print(twelve.thirteen.defensive_free_throw_seB)

twelve.thirteen.defensive_shooting_CI_low <- quantile(twelve.thirteen.bootstrap_defensive_coeff_reps[,1], alpha)
twelve.thirteen.defensive_shooting_CI_high <- quantile(twelve.thirteen.bootstrap_defensive_coeff_reps[,1], 1 - alpha)
twelve.thirteen.defensive_shooting_CI <- c(twelve.thirteen.defensive_shooting_CI_low, twelve.thirteen.defensive_shooting_CI_high)
twelve.thirteen.defensive_turnovers_CI_low <- quantile(twelve.thirteen.bootstrap_defensive_coeff_reps[,2], alpha)
twelve.thirteen.defensive_turnovers_CI_high <- quantile(twelve.thirteen.bootstrap_defensive_coeff_reps[,2], 1 - alpha)
twelve.thirteen.defensive_turnovers_CI <- c(twelve.thirteen.defensive_turnovers_CI_low, twelve.thirteen.defensive_turnovers_CI_high)
twelve.thirteen.defensive_rebounding_CI_low <- quantile(twelve.thirteen.bootstrap_defensive_coeff_reps[,3], alpha)
twelve.thirteen.defensive_rebounding_CI_high <- quantile(twelve.thirteen.bootstrap_defensive_coeff_reps[,3], 1 - alpha)
twelve.thirteen.defensive_rebounding_CI <- c(twelve.thirteen.defensive_rebounding_CI_low, twelve.thirteen.defensive_rebounding_CI_high)
twelve.thirteen.defensive_free_throw_CI_low <- quantile(twelve.thirteen.bootstrap_defensive_coeff_reps[,4], alpha)
twelve.thirteen.defensive_free_throw_CI_high <- quantile(twelve.thirteen.bootstrap_defensive_coeff_reps[,4], 1 - alpha) 
twelve.thirteen.defensive_free_throw_CI <- c(twelve.thirteen.defensive_free_throw_CI_low, twelve.thirteen.defensive_free_throw_CI_high)

print(twelve.thirteen.defensive_shooting_CI)
print(twelve.thirteen.defensive_turnovers_CI)
print(twelve.thirteen.defensive_rebounding_CI)
print(twelve.thirteen.defensive_free_throw_CI)

#thirteen.fourteen

thirteen.fourteen.defensive_shooting_seB <- sd(thirteen.fourteen.bootstrap_defensive_coeff_reps[,1])
thirteen.fourteen.defensive_turnovers_seB <- sd(thirteen.fourteen.bootstrap_defensive_coeff_reps[,2])
thirteen.fourteen.defensive_rebounding_seB <- sd(thirteen.fourteen.bootstrap_defensive_coeff_reps[,3])
thirteen.fourteen.defensive_free_throw_seB <- sd(bootstrap_defensive_coeff_reps[,4])

print(thirteen.fourteen.defensive_shooting_seB)
print(thirteen.fourteen.defensive_turnovers_seB)
print(thirteen.fourteen.defensive_rebounding_seB)
print(thirteen.fourteen.defensive_free_throw_seB)

thirteen.fourteen.defensive_shooting_CI_low <- quantile(thirteen.fourteen.bootstrap_defensive_coeff_reps[,1], alpha)
thirteen.fourteen.defensive_shooting_CI_high <- quantile(thirteen.fourteen.bootstrap_defensive_coeff_reps[,1], 1 - alpha)
thirteen.fourteen.defensive_shooting_CI <- c(thirteen.fourteen.defensive_shooting_CI_low, thirteen.fourteen.defensive_shooting_CI_high)
thirteen.fourteen.defensive_turnovers_CI_low <- quantile(thirteen.fourteen.bootstrap_defensive_coeff_reps[,2], alpha)
thirteen.fourteen.defensive_turnovers_CI_high <- quantile(thirteen.fourteen.bootstrap_defensive_coeff_reps[,2], 1 - alpha)
thirteen.fourteen.defensive_turnovers_CI <- c(thirteen.fourteen.defensive_turnovers_CI_low, thirteen.fourteen.defensive_turnovers_CI_high)
thirteen.fourteen.defensive_rebounding_CI_low <- quantile(thirteen.fourteen.bootstrap_defensive_coeff_reps[,3], alpha)
thirteen.fourteen.defensive_rebounding_CI_high <- quantile(thirteen.fourteen.bootstrap_defensive_coeff_reps[,3], 1 - alpha)
thirteen.fourteen.defensive_rebounding_CI <- c(thirteen.fourteen.defensive_rebounding_CI_low, thirteen.fourteen.defensive_rebounding_CI_high)
thirteen.fourteen.defensive_free_throw_CI_low <- quantile(thirteen.fourteen.bootstrap_defensive_coeff_reps[,4], alpha)
thirteen.fourteen.defensive_free_throw_CI_high <- quantile(thirteen.fourteen.bootstrap_defensive_coeff_reps[,4], 1 - alpha) 
thirteen.fourteen.defensive_free_throw_CI <- c(thirteen.fourteen.defensive_free_throw_CI_low, thirteen.fourteen.defensive_free_throw_CI_high)

print(thirteen.fourteen.defensive_shooting_CI)
print(thirteen.fourteen.defensive_turnovers_CI)
print(thirteen.fourteen.defensive_rebounding_CI)
print(thirteen.fourteen.defensive_free_throw_CI)

#fourteen.fifteen

fourteen.fifteen.defensive_shooting_seB <- sd(fourteen.fifteen.bootstrap_defensive_coeff_reps[,1])
fourteen.fifteen.defensive_turnovers_seB <- sd(fourteen.fifteen.bootstrap_defensive_coeff_reps[,2])
fourteen.fifteen.defensive_rebounding_seB <- sd(fourteen.fifteen.bootstrap_defensive_coeff_reps[,3])
fourteen.fifteen.defensive_free_throw_seB <- sd(bootstrap_defensive_coeff_reps[,4])

print(fourteen.fifteen.defensive_shooting_seB)
print(fourteen.fifteen.defensive_turnovers_seB)
print(fourteen.fifteen.defensive_rebounding_seB)
print(fourteen.fifteen.defensive_free_throw_seB)

fourteen.fifteen.defensive_shooting_CI_low <- quantile(fourteen.fifteen.bootstrap_defensive_coeff_reps[,1], alpha)
fourteen.fifteen.defensive_shooting_CI_high <- quantile(fourteen.fifteen.bootstrap_defensive_coeff_reps[,1], 1 - alpha)
fourteen.fifteen.defensive_shooting_CI <- c(fourteen.fifteen.defensive_shooting_CI_low, fourteen.fifteen.defensive_shooting_CI_high)
fourteen.fifteen.defensive_turnovers_CI_low <- quantile(fourteen.fifteen.bootstrap_defensive_coeff_reps[,2], alpha)
fourteen.fifteen.defensive_turnovers_CI_high <- quantile(fourteen.fifteen.bootstrap_defensive_coeff_reps[,2], 1 - alpha)
fourteen.fifteen.defensive_turnovers_CI <- c(fourteen.fifteen.defensive_turnovers_CI_low, fourteen.fifteen.defensive_turnovers_CI_high)
fourteen.fifteen.defensive_rebounding_CI_low <- quantile(fourteen.fifteen.bootstrap_defensive_coeff_reps[,3], alpha)
fourteen.fifteen.defensive_rebounding_CI_high <- quantile(fourteen.fifteen.bootstrap_defensive_coeff_reps[,3], 1 - alpha)
fourteen.fifteen.defensive_rebounding_CI <- c(fourteen.fifteen.defensive_rebounding_CI_low, fourteen.fifteen.defensive_rebounding_CI_high)
fourteen.fifteen.defensive_free_throw_CI_low <- quantile(fourteen.fifteen.bootstrap_defensive_coeff_reps[,4], alpha)
fourteen.fifteen.defensive_free_throw_CI_high <- quantile(fourteen.fifteen.bootstrap_defensive_coeff_reps[,4], 1 - alpha) 
fourteen.fifteen.defensive_free_throw_CI <- c(fourteen.fifteen.defensive_free_throw_CI_low, fourteen.fifteen.defensive_free_throw_CI_high)

print(fourteen.fifteen.defensive_shooting_CI)
print(fourteen.fifteen.defensive_turnovers_CI)
print(fourteen.fifteen.defensive_rebounding_CI)
print(fourteen.fifteen.defensive_free_throw_CI)

#fifteen.sixteen

fifteen.sixteen.defensive_shooting_seB <- sd(fifteen.sixteen.bootstrap_defensive_coeff_reps[,1])
fifteen.sixteen.defensive_turnovers_seB <- sd(fifteen.sixteen.bootstrap_defensive_coeff_reps[,2])
fifteen.sixteen.defensive_rebounding_seB <- sd(fifteen.sixteen.bootstrap_defensive_coeff_reps[,3])
fifteen.sixteen.defensive_free_throw_seB <- sd(bootstrap_defensive_coeff_reps[,4])

print(fifteen.sixteen.defensive_shooting_seB)
print(fifteen.sixteen.defensive_turnovers_seB)
print(fifteen.sixteen.defensive_rebounding_seB)
print(fifteen.sixteen.defensive_free_throw_seB)

fifteen.sixteen.defensive_shooting_CI_low <- quantile(fifteen.sixteen.bootstrap_defensive_coeff_reps[,1], alpha)
fifteen.sixteen.defensive_shooting_CI_high <- quantile(fifteen.sixteen.bootstrap_defensive_coeff_reps[,1], 1 - alpha)
fifteen.sixteen.defensive_shooting_CI <- c(fifteen.sixteen.defensive_shooting_CI_low, fifteen.sixteen.defensive_shooting_CI_high)
fifteen.sixteen.defensive_turnovers_CI_low <- quantile(fifteen.sixteen.bootstrap_defensive_coeff_reps[,2], alpha)
fifteen.sixteen.defensive_turnovers_CI_high <- quantile(fifteen.sixteen.bootstrap_defensive_coeff_reps[,2], 1 - alpha)
fifteen.sixteen.defensive_turnovers_CI <- c(fifteen.sixteen.defensive_turnovers_CI_low, fifteen.sixteen.defensive_turnovers_CI_high)
fifteen.sixteen.defensive_rebounding_CI_low <- quantile(fifteen.sixteen.bootstrap_defensive_coeff_reps[,3], alpha)
fifteen.sixteen.defensive_rebounding_CI_high <- quantile(fifteen.sixteen.bootstrap_defensive_coeff_reps[,3], 1 - alpha)
fifteen.sixteen.defensive_rebounding_CI <- c(fifteen.sixteen.defensive_rebounding_CI_low, fifteen.sixteen.defensive_rebounding_CI_high)
fifteen.sixteen.defensive_free_throw_CI_low <- quantile(fifteen.sixteen.bootstrap_defensive_coeff_reps[,4], alpha)
fifteen.sixteen.defensive_free_throw_CI_high <- quantile(fifteen.sixteen.bootstrap_defensive_coeff_reps[,4], 1 - alpha) 
fifteen.sixteen.defensive_free_throw_CI <- c(fifteen.sixteen.defensive_free_throw_CI_low, fifteen.sixteen.defensive_free_throw_CI_high)

print(fifteen.sixteen.defensive_shooting_CI)
print(fifteen.sixteen.defensive_turnovers_CI)
print(fifteen.sixteen.defensive_rebounding_CI)
print(fifteen.sixteen.defensive_free_throw_CI)

#sixteen.seventeen

sixteen.seventeen.defensive_shooting_seB <- sd(sixteen.seventeen.bootstrap_defensive_coeff_reps[,1])
sixteen.seventeen.defensive_turnovers_seB <- sd(sixteen.seventeen.bootstrap_defensive_coeff_reps[,2])
sixteen.seventeen.defensive_rebounding_seB <- sd(sixteen.seventeen.bootstrap_defensive_coeff_reps[,3])
sixteen.seventeen.defensive_free_throw_seB <- sd(bootstrap_defensive_coeff_reps[,4])

print(sixteen.seventeen.defensive_shooting_seB)
print(sixteen.seventeen.defensive_turnovers_seB)
print(sixteen.seventeen.defensive_rebounding_seB)
print(sixteen.seventeen.defensive_free_throw_seB)

sixteen.seventeen.defensive_shooting_CI_low <- quantile(sixteen.seventeen.bootstrap_defensive_coeff_reps[,1], alpha)
sixteen.seventeen.defensive_shooting_CI_high <- quantile(sixteen.seventeen.bootstrap_defensive_coeff_reps[,1], 1 - alpha)
sixteen.seventeen.defensive_shooting_CI <- c(sixteen.seventeen.defensive_shooting_CI_low, sixteen.seventeen.defensive_shooting_CI_high)
sixteen.seventeen.defensive_turnovers_CI_low <- quantile(sixteen.seventeen.bootstrap_defensive_coeff_reps[,2], alpha)
sixteen.seventeen.defensive_turnovers_CI_high <- quantile(sixteen.seventeen.bootstrap_defensive_coeff_reps[,2], 1 - alpha)
sixteen.seventeen.defensive_turnovers_CI <- c(sixteen.seventeen.defensive_turnovers_CI_low, sixteen.seventeen.defensive_turnovers_CI_high)
sixteen.seventeen.defensive_rebounding_CI_low <- quantile(sixteen.seventeen.bootstrap_defensive_coeff_reps[,3], alpha)
sixteen.seventeen.defensive_rebounding_CI_high <- quantile(sixteen.seventeen.bootstrap_defensive_coeff_reps[,3], 1 - alpha)
sixteen.seventeen.defensive_rebounding_CI <- c(sixteen.seventeen.defensive_rebounding_CI_low, sixteen.seventeen.defensive_rebounding_CI_high)
sixteen.seventeen.defensive_free_throw_CI_low <- quantile(sixteen.seventeen.bootstrap_defensive_coeff_reps[,4], alpha)
sixteen.seventeen.defensive_free_throw_CI_high <- quantile(sixteen.seventeen.bootstrap_defensive_coeff_reps[,4], 1 - alpha) 
sixteen.seventeen.defensive_free_throw_CI <- c(sixteen.seventeen.defensive_free_throw_CI_low, sixteen.seventeen.defensive_free_throw_CI_high)

print(sixteen.seventeen.defensive_shooting_CI)
print(sixteen.seventeen.defensive_turnovers_CI)
print(sixteen.seventeen.defensive_rebounding_CI)
print(sixteen.seventeen.defensive_free_throw_CI)
```


```{r}
#Correlation Boostrapping
B <- 2000
set.seed(1)
for (i in 1:B) {
  team_number <- sample(1:30, 1)
  if (team_number == 1) { #Atlanta Hawks
    boot.sample <- team_stats[which(grepl("Atlanta Hawks", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 2) { #Boston Celtics
    boot.sample <- team_stats[which(grepl("Boston Celtics", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 3) { #Brooklyn Nets
    boot.sample <- team_stats[which(grepl("Brooklyn Nets", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 4) { #Charlotte Bobcats/Charlotte Hornets
    boot.sample <- team_stats[which(grepl("Charlotte Bobcats", team_stats$Team, fixed = TRUE) | grepl("Charlotte Hornets", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 5) { #Chicago Bulls
    boot.sample <- team_stats[which(grepl("Chicago Bulls", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 6) { #Cleveland Cavaliers
    boot.sample <- team_stats[which(grepl("Cleveland Cavaliers", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 7) { #Dallas Mavericks
    boot.sample <- team_stats[which(grepl("Dallas Mavericks", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 8) { #Denver Nuggets
    boot.sample <- team_stats[which(grepl("Denver Nuggets", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 9) { #Detroit Pistons
    boot.sample <- team_stats[which(grepl("Detroit Pistons", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 10) { #Golden State Warriors
    boot.sample <- team_stats[which(grepl("Golden State Warriors", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 11) { #Houston Rockets
    boot.sample <- team_stats[which(grepl("Houston Rockets", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 12) { #Indiana Pacers
    boot.sample <- team_stats[which(grepl("Indiana Pacers", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 13) { #Los Angeles Clippers
    boot.sample <- team_stats[which(grepl("Los Angeles Clippers", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 14) { #Los Angeles Lakers
    boot.sample <- team_stats[which(grepl("Los Angeles Lakers", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 15) { #Memphis Grizzlies
    boot.sample <- team_stats[which(grepl("Memphis Grizzlies", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 16) { #Miami Heat
    boot.sample <- team_stats[which(grepl("Miami Heat", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 17) { #Milwaukee Bucks
    boot.sample <- team_stats[which(grepl("Milwaukee Bucks", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 18) { #Minnesota Timberwolves
    boot.sample <- team_stats[which(grepl("Minnesota Timberwolves", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 19) { #New Orleans Hornets/New Orleans Pelicans
    boot.sample <- team_stats[which(grepl("New Orleans Hornets", team_stats$Team, fixed = TRUE) | grepl("New Orleans Pelicans", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 20) { #New York Knicks
    boot.sample <- team_stats[which(grepl("New York Knicks", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 21) { #Oklahoma City Thunder
    boot.sample <- team_stats[which(grepl("Oklahoma City Thunder", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 22) { #Orlando Magic
    boot.sample <- team_stats[which(grepl("Orlando Magic", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 23) { #Philadelphia 76ers
    boot.sample <- team_stats[which(grepl("Philadelphia 76ers", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 24) { #Phoenix Suns
    boot.sample <- team_stats[which(grepl("Phoenix Suns", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 25) { #Portland Trail Blazers
    boot.sample <- team_stats[which(grepl("Portland Trail Blazers", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 26) { #Sacramento Kings
    boot.sample <- team_stats[which(grepl("Sacramento Kings", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 27) { #San Antonio Spurs
    boot.sample <- team_stats[which(grepl("San Antonio Spurs", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 28) { #Toronto Raptors
    boot.sample <- team_stats[which(grepl("Toronto Raptors", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 29) { #Utah Jazz
    boot.sample <- team_stats[which(grepl("Utah Jazz", team_stats$Team, fixed = TRUE)), ]
  }
  
  else if (team_number == 30) { #Washington Wizards
    boot.sample <- team_stats[which(grepl("Washington Wizards", team_stats$Team, fixed = TRUE)), ]
  }
  
  else {
    stop()
  }
  
  boot.sample.cov.matrix <- cov(boot.sample[, -c(1:2)])
  boot.sample.cor.matrix <- cor(boot.sample[, -c(1:2)])
}

